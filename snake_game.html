<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Jeu Snake classique avec contr√¥les tactiles et personnalisation">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Snake">
    <link rel="manifest" href="manifest.json">
    <title>üêç Jeu Snake</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
            color: white;
        }
        
        h1 {
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        #gameContainer {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        #gameArea {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        #gameBoard {
            border: 4px solid white;
            background-color: #1a1a2e;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        #scoreBoard {
            margin: 20px 0;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        #controls {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
        }
        
        #controls p {
            margin: 10px 0;
        }
        
        #settingsPanel {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 10px;
            min-width: 280px;
            backdrop-filter: blur(10px);
        }
        
        #settingsPanel h2 {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 22px;
            text-align: center;
        }
        
        .setting-group {
            margin-bottom: 25px;
        }
        
        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .setting-group input[type="color"] {
            width: 100%;
            height: 40px;
            border: 2px solid white;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .setting-group input[type="range"] {
            width: 100%;
            cursor: pointer;
        }
        
        .setting-group .value-display {
            text-align: center;
            margin-top: 5px;
            font-size: 16px;
            font-weight: bold;
        }
        
        button {
            margin-top: 10px;
            padding: 12px 30px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .game-over {
            background-color: #f44336 !important;
        }
        
        .game-over:hover {
            background-color: #da190b !important;
        }
        
        .color-preview {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .color-box {
            flex: 1;
            height: 30px;
            border: 2px solid white;
            border-radius: 5px;
        }
        
        /* Contr√¥les tactiles pour mobile */
        #touchControls {
            display: none;
            margin-top: 20px;
            position: relative;
            width: 200px;
            height: 200px;
        }
        
        .touch-button {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.3);
            border: 3px solid white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
            user-select: none;
            transition: all 0.1s;
            backdrop-filter: blur(5px);
        }
        
        .touch-button:active {
            background: rgba(255, 255, 255, 0.6);
            transform: scale(0.95);
        }
        
        #btnUp {
            top: 0;
            left: 70px;
        }
        
        #btnDown {
            bottom: 0;
            left: 70px;
        }
        
        #btnLeft {
            top: 70px;
            left: 0;
        }
        
        #btnRight {
            top: 70px;
            right: 0;
        }
        
        /* Afficher les contr√¥les tactiles sur mobile */
        @media (max-width: 768px) {
            #touchControls {
                display: block;
            }
            
            #gameContainer {
                flex-direction: column;
            }
            
            #settingsPanel {
                width: 100%;
                max-width: 400px;
            }
        }
        
        /* Responsive pour petit √©cran */
        @media (max-width: 500px) {
            #gameBoard {
                width: 300px;
                height: 300px;
            }
            
            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <h1>üêç Jeu Snake</h1>
    
    <div id="gameContainer">
        <div id="gameArea">
            <div id="scoreBoard">Score: 0</div>
            <canvas id="gameBoard" width="400" height="400"></canvas>
            <div id="controls">
                <p><strong>Contr√¥les:</strong></p>
                <p>‚Üë ‚Üì ‚Üê ‚Üí (Fl√®ches du clavier)</p>
                <p>ou ZQSD</p>
                <button id="startButton" onclick="startGame()">D√©marrer le jeu</button>
            </div>
            
            <div id="touchControls">
                <div class="touch-button" id="btnUp">‚Üë</div>
                <div class="touch-button" id="btnLeft">‚Üê</div>
                <div class="touch-button" id="btnRight">‚Üí</div>
                <div class="touch-button" id="btnDown">‚Üì</div>
            </div>
        </div>
        
        <div id="settingsPanel">
            <h2>‚öôÔ∏è Param√®tres</h2>
            
            <div class="setting-group">
                <label for="snakeColor">Couleur du serpent:</label>
                <input type="color" id="snakeColor" value="#4CAF50" onchange="updateColors()">
            </div>
            
            <div class="setting-group">
                <label for="foodColor">Couleur de la nourriture:</label>
                <input type="color" id="foodColor" value="#ff4444" onchange="updateColors()">
            </div>
            
            <div class="setting-group">
                <label for="backgroundColor">Couleur du fond:</label>
                <input type="color" id="backgroundColor" value="#1a1a2e" onchange="updateColors()">
            </div>
            
            <div class="color-preview">
                <div class="color-box" id="previewSnake" style="background-color: #4CAF50;"></div>
                <div class="color-box" id="previewFood" style="background-color: #ff4444;"></div>
                <div class="color-box" id="previewBg" style="background-color: #1a1a2e;"></div>
            </div>
            
            <div class="setting-group" style="margin-top: 30px;">
                <label for="speedSlider">Vitesse du jeu:</label>
                <input type="range" id="speedSlider" min="1" max="10" value="5" onchange="updateSpeed()">
                <div class="value-display" id="speedDisplay">Normale (5)</div>
            </div>
            
            <button onclick="resetSettings()" style="margin-top: 20px; background-color: #ff9800;">R√©initialiser</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameBoard');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreBoard');
        const startButton = document.getElementById('startButton');
        
        // Configuration du jeu
        const gridSize = 20;
        const tileCount = canvas.width / gridSize;
        
        // Variables de personnalisation
        let snakeColor = '#4CAF50';
        let foodColor = '#ff4444';
        let backgroundColor = '#1a1a2e';
        let gameSpeed = 5;
        let baseSpeed = 100; // milliseconds
        
        // Variables du serpent
        let snake = [{x: 10, y: 10}];
        let dx = 0;
        let dy = 0;
        let nextDx = 0;
        let nextDy = 0;
        
        // Variables de la nourriture
        let foodX = 15;
        let foodY = 15;
        
        // Variables du jeu
        let score = 0;
        let gameRunning = false;
        let gameLoop;
        
        // Contr√¥les clavier
        document.addEventListener('keydown', changeDirection);
        
        // Contr√¥les tactiles
        document.getElementById('btnUp').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (dy === 0) {
                nextDx = 0;
                nextDy = -1;
            }
        });
        
        document.getElementById('btnDown').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (dy === 0) {
                nextDx = 0;
                nextDy = 1;
            }
        });
        
        document.getElementById('btnLeft').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (dx === 0) {
                nextDx = -1;
                nextDy = 0;
            }
        });
        
        document.getElementById('btnRight').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (dx === 0) {
                nextDx = 1;
                nextDy = 0;
            }
        });
        
        // Contr√¥les tactiles avec click (pour ordinateur)
        document.getElementById('btnUp').addEventListener('click', () => {
            if (dy === 0) {
                nextDx = 0;
                nextDy = -1;
            }
        });
        
        document.getElementById('btnDown').addEventListener('click', () => {
            if (dy === 0) {
                nextDx = 0;
                nextDy = 1;
            }
        });
        
        document.getElementById('btnLeft').addEventListener('click', () => {
            if (dx === 0) {
                nextDx = -1;
                nextDy = 0;
            }
        });
        
        document.getElementById('btnRight').addEventListener('click', () => {
            if (dx === 0) {
                nextDx = 1;
                nextDy = 0;
            }
        });
        
        function changeDirection(event) {
            const key = event.key;
            
            // Fl√®ches directionnelles
            if (key === 'ArrowUp' && dy === 0) {
                nextDx = 0;
                nextDy = -1;
            } else if (key === 'ArrowDown' && dy === 0) {
                nextDx = 0;
                nextDy = 1;
            } else if (key === 'ArrowLeft' && dx === 0) {
                nextDx = -1;
                nextDy = 0;
            } else if (key === 'ArrowRight' && dx === 0) {
                nextDx = 1;
                nextDy = 0;
            }
            
            // ZQSD
            if ((key === 'z' || key === 'Z') && dy === 0) {
                nextDx = 0;
                nextDy = -1;
            } else if ((key === 's' || key === 'S') && dy === 0) {
                nextDx = 0;
                nextDy = 1;
            } else if ((key === 'q' || key === 'Q') && dx === 0) {
                nextDx = -1;
                nextDy = 0;
            } else if ((key === 'd' || key === 'D') && dx === 0) {
                nextDx = 1;
                nextDy = 0;
            }
        }
        
        function startGame() {
            if (gameRunning) return;
            
            // R√©initialiser le jeu
            snake = [{x: 10, y: 10}];
            dx = 1;
            dy = 0;
            nextDx = 1;
            nextDy = 0;
            score = 0;
            gameRunning = true;
            
            placeFood();
            updateScore();
            
            startButton.textContent = 'Jeu en cours...';
            startButton.disabled = true;
            
            // Calculer l'intervalle bas√© sur la vitesse
            const interval = calculateInterval();
            
            // D√©marrer la boucle de jeu
            gameLoop = setInterval(update, interval);
        }
        
        function calculateInterval() {
            // Vitesse 1 = 200ms (lent), Vitesse 10 = 50ms (rapide)
            return baseSpeed + (6 - gameSpeed) * 20;
        }
        
        function update() {
            // Appliquer la direction
            dx = nextDx;
            dy = nextDy;
            
            // Calculer la nouvelle position de la t√™te
            const head = {x: snake[0].x + dx, y: snake[0].y + dy};
            
            // V√©rifier les collisions avec les murs
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                gameOver();
                return;
            }
            
            // V√©rifier les collisions avec le corps
            for (let segment of snake) {
                if (head.x === segment.x && head.y === segment.y) {
                    gameOver();
                    return;
                }
            }
            
            // Ajouter la nouvelle t√™te
            snake.unshift(head);
            
            // V√©rifier si le serpent mange la nourriture
            if (head.x === foodX && head.y === foodY) {
                score += 10;
                updateScore();
                placeFood();
            } else {
                // Retirer la queue si pas de nourriture mang√©e
                snake.pop();
            }
            
            draw();
        }
        
        function draw() {
            // Effacer le canvas avec la couleur de fond personnalis√©e
            ctx.fillStyle = backgroundColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Dessiner la grille l√©g√®re
            ctx.strokeStyle = adjustBrightness(backgroundColor, 20);
            ctx.lineWidth = 1;
            for (let i = 0; i <= tileCount; i++) {
                ctx.beginPath();
                ctx.moveTo(i * gridSize, 0);
                ctx.lineTo(i * gridSize, canvas.height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i * gridSize);
                ctx.lineTo(canvas.width, i * gridSize);
                ctx.stroke();
            }
            
            // Dessiner le serpent avec la couleur personnalis√©e
            snake.forEach((segment, index) => {
                if (index === 0) {
                    // T√™te du serpent
                    ctx.fillStyle = snakeColor;
                } else {
                    // Corps du serpent (l√©g√®rement plus fonc√©)
                    ctx.fillStyle = adjustBrightness(snakeColor, -10);
                }
                
                ctx.fillRect(
                    segment.x * gridSize + 1,
                    segment.y * gridSize + 1,
                    gridSize - 2,
                    gridSize - 2
                );
                
                // Yeux du serpent sur la t√™te
                if (index === 0) {
                    ctx.fillStyle = 'white';
                    const eyeSize = 3;
                    if (dx === 1) { // Droite
                        ctx.fillRect(segment.x * gridSize + 12, segment.y * gridSize + 5, eyeSize, eyeSize);
                        ctx.fillRect(segment.x * gridSize + 12, segment.y * gridSize + 12, eyeSize, eyeSize);
                    } else if (dx === -1) { // Gauche
                        ctx.fillRect(segment.x * gridSize + 5, segment.y * gridSize + 5, eyeSize, eyeSize);
                        ctx.fillRect(segment.x * gridSize + 5, segment.y * gridSize + 12, eyeSize, eyeSize);
                    } else if (dy === -1) { // Haut
                        ctx.fillRect(segment.x * gridSize + 5, segment.y * gridSize + 5, eyeSize, eyeSize);
                        ctx.fillRect(segment.x * gridSize + 12, segment.y * gridSize + 5, eyeSize, eyeSize);
                    } else if (dy === 1) { // Bas
                        ctx.fillRect(segment.x * gridSize + 5, segment.y * gridSize + 12, eyeSize, eyeSize);
                        ctx.fillRect(segment.x * gridSize + 12, segment.y * gridSize + 12, eyeSize, eyeSize);
                    }
                }
            });
            
            // Dessiner la nourriture avec la couleur personnalis√©e
            ctx.fillStyle = foodColor;
            ctx.beginPath();
            ctx.arc(
                foodX * gridSize + gridSize / 2,
                foodY * gridSize + gridSize / 2,
                gridSize / 2 - 2,
                0,
                2 * Math.PI
            );
            ctx.fill();
        }
        
        // Fonction utilitaire pour ajuster la luminosit√© d'une couleur
        function adjustBrightness(color, amount) {
            let usePound = false;
            if (color[0] === "#") {
                color = color.slice(1);
                usePound = true;
            }
            const num = parseInt(color, 16);
            let r = (num >> 16) + amount;
            let g = ((num >> 8) & 0x00FF) + amount;
            let b = (num & 0x0000FF) + amount;
            
            r = Math.max(Math.min(255, r), 0);
            g = Math.max(Math.min(255, g), 0);
            b = Math.max(Math.min(255, b), 0);
            
            return (usePound ? "#" : "") + (r << 16 | g << 8 | b).toString(16).padStart(6, '0');
        }
        
        function placeFood() {
            let validPosition = false;
            
            while (!validPosition) {
                foodX = Math.floor(Math.random() * tileCount);
                foodY = Math.floor(Math.random() * tileCount);
                
                // V√©rifier que la nourriture n'est pas sur le serpent
                validPosition = true;
                for (let segment of snake) {
                    if (segment.x === foodX && segment.y === foodY) {
                        validPosition = false;
                        break;
                    }
                }
            }
        }
        
        function updateScore() {
            scoreDisplay.textContent = 'Score: ' + score;
        }
        
        function gameOver() {
            clearInterval(gameLoop);
            gameRunning = false;
            
            // Afficher le message de game over
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Game Over!', canvas.width / 2, canvas.height / 2 - 20);
            
            ctx.font = '24px Arial';
            ctx.fillText('Score final: ' + score, canvas.width / 2, canvas.height / 2 + 20);
            
            startButton.textContent = 'Rejouer';
            startButton.disabled = false;
            startButton.className = 'game-over';
        }
        
        // Dessiner l'√©tat initial
        draw();
        
        // Fonctions de gestion des param√®tres
        function updateColors() {
            snakeColor = document.getElementById('snakeColor').value;
            foodColor = document.getElementById('foodColor').value;
            backgroundColor = document.getElementById('backgroundColor').value;
            
            // Mettre √† jour les aper√ßus
            document.getElementById('previewSnake').style.backgroundColor = snakeColor;
            document.getElementById('previewFood').style.backgroundColor = foodColor;
            document.getElementById('previewBg').style.backgroundColor = backgroundColor;
            
            // Mettre √† jour le canvas en temps r√©el
            canvas.style.backgroundColor = backgroundColor;
            draw();
        }
        
        function updateSpeed() {
            const slider = document.getElementById('speedSlider');
            gameSpeed = parseInt(slider.value);
            
            const speedTexts = {
                1: 'Tr√®s lent (1)',
                2: 'Lent (2)',
                3: 'Plut√¥t lent (3)',
                4: 'L√©g√®rement lent (4)',
                5: 'Normale (5)',
                6: 'L√©g√®rement rapide (6)',
                7: 'Plut√¥t rapide (7)',
                8: 'Rapide (8)',
                9: 'Tr√®s rapide (9)',
                10: 'Ultra rapide (10)'
            };
            
            document.getElementById('speedDisplay').textContent = speedTexts[gameSpeed];
            
            // Si le jeu est en cours, red√©marrer avec la nouvelle vitesse
            if (gameRunning) {
                clearInterval(gameLoop);
                const interval = calculateInterval();
                gameLoop = setInterval(update, interval);
            }
        }
        
        function resetSettings() {
            // R√©initialiser les valeurs par d√©faut
            document.getElementById('snakeColor').value = '#4CAF50';
            document.getElementById('foodColor').value = '#ff4444';
            document.getElementById('backgroundColor').value = '#1a1a2e';
            document.getElementById('speedSlider').value = '5';
            
            updateColors();
            updateSpeed();
        }
        
        // Enregistrer le Service Worker pour la PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then((registration) => {
                        console.log('Service Worker enregistr√© avec succ√®s:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Erreur lors de l\'enregistrement du Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>
